/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v2.2.1
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v2.2.0
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v2.1.0
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v2.0.0
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v0.7.0
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

var Tgc2=function(){function t(e){var i=this;this.availableData={},this.beforeChartUpdate=[],this.beforeDestroy=[],this.beforeDraw=[],this.beforeInit=[],this.beforeLoad=[],this.data={nodes:[],links:[]},this.emphasesColor="#faa01b",this.inLoading=!1,this.isInit=!1,this.linkColor="#aaa",this.localization={closeButton:"关闭",dataRequestFailed:"请求数据失败",loadingLabel:"加载中...",menu:{collapse:"折叠",close:"关闭",dynamic:"动态",expand:"展开",fixed:"固定",focus:"焦点",hide:"隐藏",unfocus:"取消焦点"},toolbar:{backButton:"返回上一步",backTitle:"回退一步",exportButton:"导出",exportCSV:"导出为CSV文件",exportJpeg:"导出为JPEG文件",exportPDF:"导出为PDF文件",exportPNG:"导出为PNG文件",exportTitle:"导出数据",exportXLS:"导出为XLS文件",fitButton:"适合按钮",fitTitle:"适合屏幕",freezeButton:"锁定按钮",freezeTitle:"全部锁定",fullscreenButton:"全屏",fullscreenTitle:"切换全屏模式",rearrangeButton:"重新排列",rearrangeTitle:"重新排列元素",unfreezeTitle:"解锁全部",zoomoutButton:"缩放按钮",zoomoutTitle:"缩放"}},this.nodeColor="#00b38a",this.nodeIds={},this.onAvailableDataUpdate=[],this.onChartUpdate=[],this.onClear=[],this.onResize=[],this.onDataUpdate=[],this.onInit=[],this.onFailed=[],this.onLoad=[],this.onMergeData=[],this.onVisibleDataUpdate=[],this.pathIds={},this.reduceColor="#ddd",this.selectionColor="#9aabeb",this.visibleData={},this.netChartSettings={container:"",area:{},style:{multilinkSpacing:20,nodeDetailMinSize:10,selection:{enabled:!1,fillColor:null},nodeSelected:{radius:50},node:{fillColor:this.nodeColor,imageCropping:"crop"},nodeHovered:{shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)"},link:{fillColor:this.linkColor},linkLabel:{backgroundStyle:{lineWidth:0},textStyle:{fillColor:"#666"},rotateWithLink:!0},nodeStyleFunction:function(t){i.nodeStyleFunction(t)},linkStyleFunction:function(t){i.linkStyleFunction(t)}},auras:{cellSize:4,overlap:!0,enabled:!0,defaultStyle:{shadowColor:"#fff",showInLegend:!0},style:{}},nodeMenu:{},navigation:{focusNodeExpansionRadius:0,numberOfFocusNodes:1},info:{enabled:!0,linkContentsFunction:function(e){return t.linkContentsFunction(e)}},events:{onDoubleClick:function(t,e){i.onDoubleClick(t,e)}},filters:{nodeFilter:function(t){return!t.hidden},linkFilter:function(t){return!t.hidden}},toolbar:{enabled:!0,"export":!0,cssClass:"tgc2-float-toolbar",align:"bottom",side:"right"},localization:this.localization},this.end="",this.forceRefresh=!1,this.cacheList=[],this.historyList=[],this.settings={selector:"",extend:!1,autoResize:!1,leftPanels:{active:!0,mode:"fixed"},rightPanels:{active:!1,mode:"overlay"},floatPanels:{enable:!0,style:{top:"20px",right:"60px"}},netChart:{autoRelayout:!1,nodeDefaultColor:this.nodeColor,linkDefaultColor:this.linkColor,emphasesColor:this.emphasesColor,reduceColor:this.reduceColor,settings:{}},loader:$.noop},this.start="",this.settings.netChart.settings=this.netChartSettings,$.extend(!0,this.settings,e),this.resetToolbar()}return t.prototype.addBeforeChartUpdate=function(t){this.beforeChartUpdate.push(t)},t.prototype.addBeforeDestroy=function(t){this.beforeDestroy.push(t)},t.prototype.addBeforeDraw=function(t){this.beforeDraw.push(t)},t.prototype.addBeforeInitEvent=function(t){this.beforeInit.push(t)},t.prototype.addBeforeLoad=function(t){this.beforeLoad.push(t)},t.prototype.addLeftPanel=function(t,e,i,n){void 0===n&&(n=!1),this.select(".tgc2-left-panels:empty").html('<div class="tgc2-panels-tabs"></div><div class="tgc2-panels-pages"></div><div class="tgc2-panels-control"><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div></div>');var a=(t?'<div class="tgc2-panels-icon">'+t+"</div>":"")+(i?'<div class="tgc2-panels-tooltip">'+i+"</div>":""),s=this.getContainer().find(".tgc2-left-panels");return this.addPanel(a,e,s,n)},t.prototype.addMainPanel=function(t,e,i,n){void 0===e&&(e=""),void 0===i&&(i=""),void 0===n&&(n=!1);var a='<div class="tgc2-panels-icon">'+e+'</div><div class="tgc2-panels-tooltip">'+i+"</div>",s=this.getContainer().find(".tgc2-main-panels");return this.addPanel(a,t,s,n)},t.prototype.addRightPanel=function(t,e,i,n){void 0===n&&(n=!1),this.select(".tgc2-right-panels:empty").html('<div class="tgc2-panels-tabs"></div><div class="tgc2-panels-pages"></div><div class="tgc2-panels-control"><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div></div>');var a=(t?'<div class="tgc2-panels-icon">'+t+"</div>":"")+(i?'<div class="tgc2-panels-tooltip">'+i+"</div>":""),s=this.getContainer().find(".tgc2-right-panels");return this.addPanel(a,e,s,n)},t.prototype.addFloatPanel=function(t,e,i,n){void 0===n&&(n=!1),this.select(".tgc2-float-panels:empty").html('<div class="tgc2-panels-tabs"></div><div class="tgc2-panels-pages"></div><div class="tgc2-panels-control"><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div><div class="tgc2-panels-control-line"></div></div>');var a=(t?'<div class="tgc2-panels-icon">'+t+"</div>":"")+(i?'<div class="tgc2-panels-tooltip">'+i+"</div>":""),s=this.getContainer().find(".tgc2-float-panels");return this.addPanel(a,e,s,n)},t.prototype.addOnAvailableDataUpdate=function(t){this.onAvailableDataUpdate.push(t)},t.prototype.addOnChartUpdate=function(t){this.onChartUpdate.push(t)},t.prototype.addOnClear=function(t){this.onClear.push(t)},t.prototype.addOnDataUpdate=function(t){this.onDataUpdate.push(t)},t.prototype.addOnResize=function(t){this.onResize.push(t)},t.prototype.addOnVisibleDataUpdate=function(t){this.onVisibleDataUpdate.push(t)},t.prototype.addOnInitEvent=function(t){this.onInit.push(t)},t.prototype.addOnFailed=function(t){this.onFailed.push(t)},t.prototype.addOnLoad=function(t){this.onLoad.push(t)},t.prototype.addOnMergeData=function(t){this.onMergeData.push(t)},t.prototype.back=function(){if(this.historyList.length>1&&(this.historyList.pop(),this.cacheList.length>this.historyList.length&&this.cacheList.pop(),this.historyList.length)){var t=this.cacheList[this.historyList[this.historyList.length-1].idx];this.drawHistory(t)}1==this.historyList.length&&this.select(".chart-his").addClass("disabled DVSL-bar-disabled")},t.prototype.clear=function(){this.settings.extend||(this.data={nodes:[],links:[]},this.availableData=this.data,this.visibleData={nodes:[],links:[]}),t.callEvent(this.onClear)},t.prototype.clearEmphasesNode=function(){this.nodeIds={}},t.prototype.clearEmphasesPath=function(){this.pathIds={}},t.prototype.destroy=function(){this.$container&&(t.callEvent(this.beforeDestroy),this.isInit=!1,this.$container.removeClass("tgc2").empty(),this.$container=null)},t.prototype.drawHistory=function(t){this.startInfo=t.startInfo,this.clear(),this.data=$.extend(!0,{},t.data),this.drawResult()},t.prototype.getContainer=function(){return this.$container},t.prototype.getMainContainer=function(){return this.$mainContainer},t.prototype.getAvailableData=function(){return this.availableData},t.prototype.getData=function(){return this.data},t.prototype.getDimensions=function(){return{width:this.getContainer().width(),height:this.getContainer().height()}},t.prototype.getStartInfo=function(){return this.startInfo},t.prototype.getVisibleData=function(){return this.visibleData},t.prototype.hasVisibleData=function(){return!!(this.visibleData.nodes&&this.visibleData.nodes.length&&this.visibleData.links&&this.visibleData.links.length)},t.prototype.init=function(){this.isInit||(t.callEvent(this.beforeInit),this.$container=$(this.settings.selector).addClass("tgc2"),this.initTemplate(),this.initNetChart(),this.autoResize(),t.callEvent(this.onInit),this.isInit=!0)},t.prototype.load=function(t){this.isInit||this.init(),this.inLoading||this.getGraphData(t)},t.prototype.randomId=function(t){return void 0===t&&(t=""),t+(new Date).getTime()+Math.floor(1e3*Math.random())},t.prototype.resize=function(){this.netChart.updateSize(),t.callEvent(this.onResize)},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.setEmphasesNode=function(t){for(var e={},i=0,n=t;i<n.length;i++){var a=n[i];e[a]=!0}this.nodeIds=e},t.prototype.setEmphasesPath=function(t){for(var e={},i=0,n=t;i<n.length;i++){var a=n[i];e[a]=!0}this.pathIds=e},t.prototype.updateChart=function(){t.callEvent(this.beforeChartUpdate);for(var e=0,i=this.availableData.nodes;e<i.length;e++){var n=i[e];this.inStart(n.id)?n.hidden=!1:this.hasVisibleData()?n.hidden=_.indexOf(this.visibleData.nodes,n.id)<0:n.hidden=!1}for(var a=0,s=this.availableData.links;a<s.length;a++){var o=s[a];this.hasVisibleData()?o.hidden=_.indexOf(this.visibleData.links,o.id)<0:o.hidden=!1}this.netChart.replaceData(this.availableData),t.callEvent(this.onChartUpdate)},t.prototype.updateAvailableData=function(e){this.availableData=e,t.callEvent(this.onAvailableDataUpdate)},t.prototype.updateData=function(e){this.data=e,t.callEvent(this.onDataUpdate)},t.prototype.updateVisibleData=function(e){this.visibleData=e,t.callEvent(this.onVisibleDataUpdate)},t.prototype.activePanel=function(t,e){void 0===e&&(e=!1);var i=this.select('[data-id="'+t+'"]'),n=this.select("#"+t);if(e){var a=i.closest(".tgc2-panels");i.hasClass("active")?(i.removeClass("active"),a.removeClass("active"),n.removeClass("active")):(a.addClass("active"),i.addClass("active").siblings(".active").removeClass("active"),n.addClass("active").siblings(".active").removeClass("active"))}else i.addClass("active").siblings(".active").removeClass("active"),n.addClass("active").siblings(".active").removeClass("active")},t.prototype.addPanel=function(t,e,i,n){void 0===n&&(n=!1);var a=this.randomId("panel-"),s=n?"active":"",o=$('<div class="tgc2-panels-tab '+s+'" data-id="'+a+'"></div>');if(o.append(t),i.find(".tgc2-panels-tabs").append(o),i.hasClass("tgc2-panels-fixed")){var r=100/i.find(".tgc2-panels-tabs").children().length+"%";i.find(".tgc2-panels-tabs").children().width(r)}var l=$('<div class="tgc2-panels-page '+s+'" id="'+a+'"></div>');return l.append(e),i.find(".tgc2-panels-pages").append(l),a},t.prototype.autoResize=function(){var t=this;this.settings.autoResize&&(this.resizeInterval&&clearInterval(this.resizeInterval),this.resizeInterval=setInterval(function(){var e=t.getDimensions();_.isEqual(t.dimensions,e)||(t.resize(),t.dimensions=e)},100))},t.prototype.buildLeftPanelContainer=function(){var t=this.settings.leftPanels.active?"active":"",e='<div class="tgc2-panels tgc2-left-panels tgc2-panels-'+this.settings.leftPanels.mode+" "+t+'"></div>';this.getContainer().append(e)},t.prototype.buildMainPanelContainer=function(){var t='<div class="tgc2-panels tgc2-main-panels"><div class="tgc2-panels-tabs"></div><div class="tgc2-panels-pages"></div></div>';this.getContainer().append(t)},t.prototype.buildRightPanelContainer=function(){var t=this.settings.rightPanels.active?"active":"",e='<div class="tgc2-panels tgc2-right-panels tgc2-panels-'+this.settings.rightPanels.mode+" "+t+'"></div>';this.getContainer().append(e)},t.prototype.buildFloatPanelContainer=function(){var t=$('<div class="tgc2-panels tgc2-float-panels"></div>');t.css(this.settings.floatPanels.style),this.getContainer().append(t)},t.callEvent=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];n()}},t.prototype.drawResult=function(){this.availableData=this.data,t.callEvent(this.beforeDraw),this.updateResult(),this.updateChart(),this.settings.netChart.autoRelayout&&this.netChart.resetLayout()},t.prototype.getGraphData=function(e){var i=this;this.startInfo=e,t.callEvent(this.beforeLoad),this.clear(),this.inLoading=!0,this.settings.loader(this,function(e){i.data=i.mergeData(i.data,e),i.updateStartInfo();var n={startInfo:i.startInfo,data:$.extend(!0,{},i.data)},a={startInfo:i.startInfo,idx:i.cacheList.length};i.cacheList.push(n),i.historyList.push(a),t.callEvent(i.onLoad),i.drawResult(),i.inLoading=!1},function(){t.callEvent(i.onFailed),i.inLoading=!1})},t.prototype.mergeData=function(t,e){for(var i in e){for(var n=!1,a=0,s=this.onMergeData;a<s.length;a++){var o=s[a];if(o(t[i],e[i])){n=!0;break}}n||($.isArray(e[i])?t[i]=_.unionBy(t[i],e[i]):t[i]=e[i])}return t},t.prototype.initEvent=function(){var t=this;this.getContainer().on("mouseenter",".tgc2-tooltip-container",function(t){var e=$(t.currentTarget).find(".tgc2-tooltip");e.removeClass("tgc2-tooltip-fadeOut"),e.addClass("tgc2-tooltip-fadeIn")}),this.getContainer().on("mouseleave",".tgc2-tooltip-container",function(t){var e=$(t.currentTarget).find(".tgc2-tooltip");e.removeClass("tgc2-tooltip-fadeIn"),e.addClass("tgc2-tooltip-fadeOut"),setTimeout(function(){e.removeClass("tgc2-tooltip-fadeOut")},280)}),this.select(".chart-his").on("click",function(){t.back()}),this.select(".chart-reset").on("click",function(){t.netChart.resetLayout()}),this.getContainer().on("click",".tgc2-panels-tab",function(e){var i=$(e.target).closest(".tgc2-panels-tab").attr("data-id");t.activePanel(i,!0)}),this.getContainer().on("click",".tgc2-panels-control",function(e){$(e.target).closest(".tgc2-panels").toggleClass("active"),setTimeout(function(){t.resize()},300)})},t.prototype.initNetChart=function(){var t=this.settings.netChart.settings;!t.container&&(t.container=this.getContainer().find(".tgc2-netchart-container")[0]),this.netChart=new NetChart(t)},t.prototype.initTemplate=function(){this.buildLeftPanelContainer(),this.buildRightPanelContainer(),this.buildMainPanelContainer(),this.settings.floatPanels.enable&&this.buildFloatPanelContainer(),this.addMainPanel('<div class="tgc2-netchart-container"></div>',"","",!0),this.$mainContainer=this.$container.find(".tgc2-netchart-container"),this.initEvent()},t.linkContentsFunction=function(t){return t.typeName},t.prototype.linkStyleFunction=function(t){t.label=t.data.typeName,t.toDecoration="arrow",t.fillColor=t.data.color||this.settings.netChart.linkDefaultColor||t.fillColor,this.pathIds[t.id]?(t.fillColor=this.settings.netChart.emphasesColor,t.label=t.data.typeName,t.radius=3*t.radius):$.isEmptyObject(this.pathIds)||(t.fillColor=this.settings.netChart.reduceColor,t.label="")},t.prototype.nodeStyleFunction=function(t){t.label=t.data.name,t.lineWidth=2,t.fillColor=t.data.color||this.settings.netChart.nodeDefaultColor||t.fillColor,t.labelStyle.textStyle.font="18px Microsoft Yahei",t.aura=t.data.auras,this.inStart(t.id)&&(t.radius=50,t.fillColor=this.settings.netChart.emphasesColor),this.nodeIds[t.id]?(t.fillColor=this.settings.netChart.emphasesColor,t.label=t.data.name,t.radius=1.5*t.radius):$.isEmptyObject(this.nodeIds)||(t.fillColor=this.settings.netChart.reduceColor,t.radius=.5*t.radius)},t.prototype.onDoubleClick=function(t,e){},t.prototype.resetToolbar=function(){var t=this,e=this.settings.netChart.settings;if(e.toolbar.enabled){if(e.toolbar.items=[],e.toolbar.extraItems=e.toolbar.extraItems||[],e.toolbar.zoomControl!==!1&&e.toolbar.extraItems.push("fit"),e.toolbar.zoomControl!==!1&&e.toolbar.extraItems.push("rearrange"),e.toolbar.zoomControl!==!1&&e.toolbar.extraItems.push("freeze"),e.toolbar.zoomControl!==!1&&e.toolbar.extraItems.push("export"),e.toolbar.back!==!1){e.toolbar.back=!1;var i=e.localization.toolbar.backButton;e.toolbar.extraItems.push({label:i,cssClass:"DVSL-bar-btn-back DVSL-bar-disabled chart-his disabled",onClick:function(){t.back()}})}if(e.toolbar.fullscreen!==!1){e.toolbar.fullscreen=!1;var i=e.localization.toolbar.fullscreenTitle;e.toolbar.extraItems.push({label:i,cssClass:"DVSL-bar-btn-fullscreen",onClick:function(e){$(e.target).closest(".DVSL-bar-btn").toggleClass("DVSL-bar-btn-fullscreen DVSL-bar-btn-fullscreen-active"),t.$container.toggleClass("fullscreen");var i=t.settings.netChart.callback;i&&i.onFullScreenChange&&i.onFullScreenChange(t.$container.hasClass("fullscreen"))}})}e.toolbar.extraItems.length>0&&e.toolbar.extraItems.push({label:"展开工具栏",cssClass:"DVSL-bar-btn-control",onClick:function(t){var e=$(t.target).closest(".DVSL-bar-btn");e.closest(".tgc2-float-toolbar").toggleClass("active"),e.toggleClass("DVSL-bar-btn-control DVSL-bar-btn-control-active"),e.hasClass("DVSL-bar-btn-control-active")?e.attr("title","收起工具栏"):e.attr("title","展开工具栏")}}),e.toolbar.zoomControl!==!1&&e.toolbar.extraItems.push("zoomControl")}},t.prototype.updateResult=function(){this.select(".tgc2-netchart-nodata").remove(),this.availableData.nodes.length||this.select(".tgc2-netchart-container").append('<div class="tgc2-netchart-nodata">没有相关数据</div>')},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Tgc2Graph=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.inStart=function(t){return this.startInfo.id==t},e.prototype.onDoubleClick=function(t,e){e.clickNode&&e.clickNode.data.id!=this.startInfo.id&&(this.select(".chart-his").removeClass("disabled DVSL-bar-disabled"),this.load(e.clickNode.data))},e.prototype.updateStartInfo=function(){var t=this;this.startInfo=_.find(this.data.nodes,function(e){return e.id==t.startInfo.id})},e}(Tgc2),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Tgc2Path=function(t){function e(e){var i=t.call(this,e)||this;return i.addOnInitEvent(function(){i.initPathPanel()}),i.addBeforeLoad(function(){i.initPathStartInfo()}),i}return __extends(e,t),e.prototype.getStartInfo=function(){var t={},e=this.select(".tgc2-path-start").data("data"),i=this.select(".tgc2-path-end").data("data");return e&&i?(t.id=e.id+"-"+i.id,t.start=e,t.end=i,this.startInfo=t):toastr.error("起点和终点不能为空"),t},e.prototype.inStart=function(t){return this.startInfo.start.id==t||this.startInfo.end.id==t},e.prototype.initPathPanel=function(){var t=this,e="定向分析",i='<div class="tgc2-path"><div class="tgc2-path-prompt-container"><div class="tgc2-path-label">起点：</div><div class="tgc2-path-start"></div></div><div class="tgc2-path-prompt-container"><div class="tgc2-path-label">终点：</div><div class="tgc2-path-end"></div></div><div class="tgc2-path-preview"><button class="btn btn-primary btn-preview">预览</button></div></div>';this.addLeftPanel("",i,e,!0);var n={onSearch:function(t,e){e.find('input[type="text"]').val(t.name),e.data("data",t)},onSelectItemChange:function(t,e){if(t){var i=e.find('input[type="text"]').val();t.name==i&&e.data("data",t)}else e.removeData("data")},onSearchTextChange:function(t,e){e.removeData("data")}},a=$.extend(!0,{},n,this.settings.path.prompt.settings),s=$.extend(!0,{},n,this.settings.path.prompt.settings);a.container=".tgc2-path-start",s.container=".tgc2-path-end",this.startPrompt=new hieknPrompt(a),this.endPrompt=new hieknPrompt(s),this.select(".tgc2-path-preview .btn-preview").on("click",function(){var e=t.getStartInfo();e.start&&e.end&&t.load(e)})},e.prototype.initPathStartInfo=function(){this.startInfo.start&&this.startInfo.start.name&&(this.select(".tgc2-path-start").data("data",this.startInfo.start),this.select(".tgc2-path-start").find("input").val(this.startInfo.start.name)),this.startInfo.end&&this.startInfo.end.name&&(this.select(".tgc2-path-end").data("data",this.startInfo.end),this.select(".tgc2-path-end").find("input").val(this.startInfo.end.name)),this.startInfo.id="id-"+(new Date).getTime()},e.prototype.updateStartInfo=function(){var t=this,e=_.find(this.data.nodes,function(e){return e.id==t.startInfo.start.id}),i=_.find(this.data.nodes,function(e){return e.id==t.startInfo.end.id});e&&(this.startInfo.start=e),i&&(this.startInfo.end=i),this.initPathStartInfo()},e}(Tgc2),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Tgc2Relation=function(t){function e(e){var i=t.call(this,e)||this;return i.addOnInitEvent(function(){i.initPathPanel()}),i.addBeforeLoad(function(){i.initRelationStartInfo()}),i}return __extends(e,t),e.prototype.getStartInfo=function(){var t={},e=this.getRelationNodes();return e.length>1?(t.nodes=e,this.startInfo=t):toastr.error("分析对象不能少于两个"),t},e.prototype.inStart=function(t){return!!_.find(this.startInfo.nodes,function(e){return e.id==t})},e.prototype.initPathPanel=function(){var t=this,e="定向分析",i='<div class="tgc2-relation"><div class="tgc2-relation-prompt-container"><div class="tgc2-relation-label">添加对象：</div><div class="tgc2-relation-prompt"></div></div><div class="tgc2-relation-data-container"><div class="tgc2-relation-data-title">分析对象</div><ul></ul></div><div class="tgc2-relation-preview"><button class="btn btn-primary btn-preview">预览</button></div></div>';this.addLeftPanel("",i,e,!0);var n={onSearch:function(e,i){i.find('input[type="text"]').val(""),t.addRelationNode(e)}},a=$.extend(!0,{},n,this.settings.relation.prompt.settings);a.container=".tgc2-relation-prompt",this.relationPrompt=new hieknPrompt(a),this.select(".tgc2-relation-preview .btn-preview").on("click",function(){var e=t.getStartInfo();e.nodes.length>1&&t.load(e)}),this.select(".tgc2-relation-data-container").on("click","li svg",function(e){t.removeRelationNode(e)}),this.select(".tgc2-relation-data-container").on("mouseenter","li",function(e){var i=$(e.target).closest("li").data("data");t.setEmphasesNode([i.id]),t.netChart.updateStyle()}),this.select(".tgc2-relation-data-container").on("mouseleave","li",function(e){t.clearEmphasesNode(),t.netChart.updateStyle()})},e.prototype.addRelationNode=function(t){if(this.inRelationNodes(t))return void toastr.error("该对象已添加");if(t.name){var e=t.name;t.meaningTag&&(e+="["+t.meaningTag+"]");var i=$("<li>"+e+'<svg height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg></li>').data("data",t);this.select(".tgc2-relation-data-container ul").append(i)}},e.prototype.getRelationNodes=function(){var t=[];return this.select(".tgc2-relation-data-container ul").children("li").each(function(e,i){t.push($(i).data("data"))}),t},e.prototype.inRelationNodes=function(t){var e=this.getRelationNodes();return!!_.find(e,function(e){return e.id==t.id})},e.prototype.removeRelationNode=function(t){$(t.target).closest("li").remove()},e.prototype.initRelationStartInfo=function(){this.select(".tgc2-relation-data-container ul").empty();for(var t=0,e=this.startInfo.nodes;t<e.length;t++){var i=e[t];this.addRelationNode(i)}this.startInfo.id="id-"+(new Date).getTime()},e.prototype.updateStartInfo=function(){var t=this.startInfo.nodes;for(var e in this.startInfo.nodes)this.startInfo.nodes[e]=_.find(this.data.nodes,function(i){return i.id==t[e].id});this.initRelationStartInfo()},e}(Tgc2),Tgc2Connects=function(){function t(e,i){var n=this;this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addBeforeDraw(function(){return n.beforeDraw()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){var t=this;t.getContainer().on("mouseenter",".tgc2-connects-content",function(){var e=$(this).data("data"),i=e.nodes,n=e.edges;t.tgc2.setEmphasesNode(i),t.tgc2.setEmphasesPath(n),t.tgc2.netChart.updateStyle()}),t.getContainer().on("mouseleave",".tgc2-connects-content",function(){t.tgc2.clearEmphasesNode(),t.tgc2.clearEmphasesPath(),t.tgc2.netChart.updateStyle()})},t.prototype.initTemplate=function(){if(this.settings.enable){var t="图解读",e='<div class="tgc2-connects"></div>';this.tgc2.addLeftPanel("",e,t),this.$container=this.tgc2.select(".tgc2-left-panels"),this.initEvent()}},t.prototype.beforeDraw=function(){var t=this.tgc2.getData();this.drawData(t)},t.prototype.drawData=function(t){var e=t.connects;this.select(".tgc2-connects").empty();var i="";if(e&&e.length){var n=function(n){var s=e[n],o=_.find(t.nodes,function(t){return t.id==s.start}),r=_.find(t.nodes,function(t){return t.id==s.end}),l=o.name,c=r.name,d=$('<div class="tgc2-connects-content"><div class="tgc2-connects-index">'+(parseInt(n)+1)+'</div><div class="tgc2-connects-detail"><div class="tgc2-connects-subtitle"><i></i>'+l+"<span></span>"+c+'</div><ul class="tgc2-connects-ul"></ul></div></div>');a.select(".tgc2-connects").append(d),s.edges&&s.edges.length?(s.edges.forEach(function(e,i){var n=_.find(t.nodes,function(t){return t.id==s.nodes[i]}),a=_.find(t.nodes,function(t){return t.id==s.nodes[i+1]}),l=n.name,c=a.name,h=n.id==o.id,g=a.id==r.id,p="未知",f="tgc2-arrow-to",u="";if(e){var v=_.find(t.links,function(t){return t.id==e});p=v.typeName,f=v.from==n.id?"tgc2-arrow-to":"tgc2-arrow-from";for(var m=_.concat(v.nRInfo||[],v.oRInfo||[]),b=0,y=m;b<y.length;b++){var C=y[b],w=C.kvs;for(var x in w)w.hasOwnProperty(x)&&(u+="<li>"+w[x].v+"</li>")}}var D=$('<li class="tgc2-connects-li"><div><span class="'+(h?"tgc2-connects-start":"")+'">'+l+'</span><span class="tgc2-arrow '+f+'">'+p+'</span><span class="'+(g?"tgc2-connects-end":"")+'">'+c+'</span></div><ul class="tgc2-connects-li-sub">'+u+"</ul></li>");d.find(".tgc2-connects-ul").append(D)}),d.data("data",s),a.select(".tgc2-connects").append(d)):i='<div class="no-data">暂无数据</div>'},a=this;for(var s in e)n(s)}else i='<div class="no-data">暂无数据</div>';i&&this.select(".tgc2-connects").append(i)},t}();Tgc2Connects.defaultSettings={enable:!1};var Tgc2Crumb=function(){function t(e,i){var n=this;this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addBeforeDraw(function(){n.beforeDraw()}),this.tgc2.addOnInitEvent(function(){n.initTemplate()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.beforeDraw=function(){var t=this.tgc2.cacheList;this.select(".tgc2-crumb").empty();for(var e in t){var i=t[e],n=i.startInfo,a=parseInt(e)==this.tgc2.historyList[this.tgc2.historyList.length-1].idx,s=$(this.drawItem(n,a)).data("data",i);this.select(".tgc2-crumb").append(s)}},t.prototype.drawItem=function(t,e){var i=e?"tgc2-crumb-select":"";if(!this.settings.drawItem){var n="";if(this.tgc2 instanceof Tgc2Graph)n=t.name;else if(this.tgc2 instanceof Tgc2Path)n=t.start.name+"--"+t.end.name;else if(this.tgc2 instanceof Tgc2Relation)for(var a=0,s=t.nodes;a<s.length;a++){var o=s[a];n+=o.name+" "}return'<div class="tgc2-crumb-item '+i+'" title="'+n+'"><i></i>'+n+"</div>"}this.settings.drawItem(t,i)},t.prototype.initEvent=function(){var t=this;this.getContainer().on("click",".tgc2-crumb-item",function(){var e=$(this).data("data"),i={startInfo:e.startInfo,idx:$(this).index()};t.tgc2.historyList.push(i),t.tgc2.drawHistory(e)})},t.prototype.initTemplate=function(){if(this.settings.enable){var t='<svg height="30" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M0 0h24v24H0z" fill="none"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>',e='<div class="tgc2-crumb"></div>';this.tgc2.addFloatPanel(t,e,"历史"),this.$container=this.tgc2.select(".tgc2-float-panels"),this.initEvent()}},t}();Tgc2Crumb.defaultSettings={enable:!1};var Tgc2Event=function(){function t(e,i){var n=this;this.events=[],this.showEvents=[],this.visibleEvents=[],this.start="",this.end="",this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.settings.enable&&(this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addBeforeDraw(function(){n.beforeDraw()}),this.tgc2.addOnChartUpdate(function(){n.buildEvents(),n.drawEvents()}))}return t.prototype.drawEvents=function(){var t="",e=null,i=this.select(".tgc2-event-content-container"),n=_.clone(this.visibleEvents);n=this.settings.groupEvent(n),n=_.orderBy(n,["timestamp"],["desc"]),this.showEvents=n,i.find(".tgc2-event-year-item-container").remove();var a="",s=0;for(var o in n){var r=n[o],l=this.tgc2.getVisibleData();if(l.nodes&&l.nodes.length&&l.links&&l.links.length){if(_.union(l.links,r.ids).length===l.links.length+r.ids.length)continue;if(r.from!=this.tgc2.startInfo.id&&_.union(l.nodes,r.fromIds).length===l.nodes.length+r.fromIds.length)continue;if(r.to!=this.tgc2.startInfo.id&&_.union(l.nodes,r.toIds).length===l.nodes.length+r.toIds.length)continue}s++,t!=r.year+""&&(t=r.year+"",e?e.html(a)&&i.append(e):"",e=$('<div class="tgc2-event-year-item-container"></div>'),a=""),a+='<div class="tgc2-event-item" data-index="'+o+'"><div class="tgc2-event-time"><div class="tgc2-event-year">'+r.year+'</div><div class="tgc2-event-day">'+r.day+'</div></div><div class="tgc2-event-pointer"><div class="tgc2-event-pointer"></div></div>'+this.settings.buildDetail(r)+"</div>"}e?e.html(a)&&i.append(e):"",this.select(".tgc2-event-time-range").text(this.start+" 至 "+this.end),this.select(".tgc2-event-item-count").text(s)},t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.beforeDraw=function(){this.updateEventDetail(this.tgc2.getData())},t.prototype.buildEvents=function(){this.start=this.tgc2.start,this.end=this.tgc2.end;var t=new Date(this.start).getTime(),e=new Date(this.end).getTime();this.visibleEvents=_.filter(this.events,function(i){return i.timestamp>=t&&i.timestamp<=e})},t.buildDetail=function(t){var e="";for(var i in t.detail)t.detail.hasOwnProperty(i)&&(e+='<tr><td class="tgc2-detail-key" title="'+i+'"><div>'+i+'</div></td><td class="tgc2-detail-value">'+t.detail[i]+"</td></tr>");return'<table class="event-detail">'+e+"</table>"},t.groupEvent=function(t){for(var e=[],i=function(t){if(t.fromIds=[t.from],t.toIds=[t.to],t.ids=[t.id],_.isEmpty(t.detail))e.push(t);else{var i=_.find(e,function(e){return _.isEqual(e.detail,t.detail)&&_.isEqual(e.timestamp,t.timestamp)});i?(i.fromIds.push(t.from),i.toIds.push(t.to),i.ids.push(t.id)):e.push(t)}},n=0,a=t;n<a.length;n++){var s=a[n];i(s)}return e},t.prototype.initEvent=function(){var t=this;this.getContainer().on("mouseenter",".tgc2-event-item",function(){var e=t.showEvents[$(this).attr("data-index")];t.tgc2.setEmphasesPath(e.ids||[e.id]);var i=[];i=e.fromIds&&e.toIds?_.union(e.fromIds,e.toIds):[e.from,e.to],t.tgc2.setEmphasesNode(i),t.tgc2.netChart.updateStyle()}).on("mouseleave",".tgc2-event-item",function(){t.tgc2.clearEmphasesPath(),t.tgc2.clearEmphasesNode(),t.tgc2.netChart.updateStyle()})},t.prototype.initTemplate=function(){var t='<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>',e='<div class="tgc2-event-title"><div class="tgc2-event-title-container"><div><span class="tgc2-event-time-range">-</span></div><div>发生事件总数：<span class="tgc2-event-item-count">0</span></div></div></div>',i='<div class="tgc2-event-content"><div class="tgc2-event-content-container"><div class="tgc2-event-content-line"></div></div></div>';this.tgc2.addLeftPanel(t,i,e,!0),this.$container=this.tgc2.select(".tgc2-left-panels"),this.initEvent()},t.prototype.updateEventDetail=function(e){this.events=t.updateEventInfo(e.links);for(var i=function(t){var i=_.find(e.nodes,function(e){return e.id==t.from}),a=_.find(e.nodes,function(e){return e.id==t.to});t.detail=n.settings.gentEventDetail(i,a,t)},n=this,a=0,s=this.events;a<s.length;a++){var o=s[a];i(o)}},t.updateEventInfo=function(t){for(var e=[],i=0,n=t;i<n.length;i++)for(var a=n[i],s=0,o=0,r=a.bsTime;o<r.length;o++){var l=r[o],c=$.extend(!0,{},a),d=new Date(l);c.timestamp=d.getTime(),c.year=d.getFullYear(),c.day=_.padStart(d.getMonth()+1+"",2,"0")+"-"+_.padStart(d.getDate()+"",2,"0"),
c.oRInfo&&c.oRInfo.length&&(c.oRInfo=[c.oRInfo[s]]),c.nRInfo&&c.nRInfo.length&&(c.nRInfo=[c.nRInfo[s]]),e.push(c),s++}return e},t}();Tgc2Event.defaultSettings={enable:!1,style:{top:"0",right:"auto",bottom:"0",left:"0",width:"320px"},gentEventDetail:function(t,e,i){var n={};if(i.oRInfo&&i.oRInfo.length&&i.oRInfo[0].kvs)for(var a=0,s=i.oRInfo[0].kvs;a<s.length;a++){var o=s[a];n[o.k]=o.v}if(i.nRInfo&&i.nRInfo.length&&i.nRInfo[0].kvs)for(var r=0,l=i.nRInfo[0].kvs;r<l.length;r++){var o=l[r];n[o.k]=o.v}return n},groupEvent:function(t){return Tgc2Event.groupEvent(t)},buildDetail:function(t){return Tgc2Event.buildDetail(t)}};var Tgc2Facet=function(){function t(e,i){var n=this;this.facet={brush:{isBrush:!1,arrBrush:[],series:{all:{}}}},this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addBeforeDraw(function(){return n.beforeDraw()}),this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addOnLoad(function(){n.onLoad()}),this.tgc2.addOnAvailableDataUpdate(function(){n.drawFacetPanel()}),this.tgc2.addOnClear(function(){n.clearSelectedFacet()}),this.tgc2.addBeforeChartUpdate(function(){n.updateAuras()})}return t.prototype.clearSelectedFacet=function(){this.select(".tgc2-facet-selected>*").empty()},t.prototype.getContainer=function(){return this.$container},t.prototype.removeFacetByTag=function(t){this.select(".tgc2-facet-selected").find('li[tag="'+t+'"]').remove(),this.select(".tgc2-facet-control-container").find('li[tag="'+t+'"]').removeClass("selected")},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.beforeDraw=function(){this.drawFacetName(),this.drawFacetPanel(),this.updateColor()},t.prototype.brushColor=function(){var t=this;this.facet.brush.arrBrush=[],this.select(".tgc2-facet-control-container>.tab-content>.tab-pane.active").find(".tab-pane.active").find("li").each(function(e,i){var n=$(i).attr("tag");t.facet.brush.isBrush?($(i).css({background:t.facet.brush.series.all[n].fillColor}),t.facet.brush.arrBrush.push(n)):$(i).removeAttr("style")}),this.tgc2.updateChart()},t.prototype.drawFacetName=function(){var t=this,e=this.tgc2.startInfo.name||_.find(this.tgc2.getData().nodes,function(e){return e.id==t.tgc2.startInfo.id}).name;this.select(".ctrl-filter-ent").text(e)},t.prototype.drawFacetPanel=function(){var t=this.getEventsFacet(this.tgc2.getData().links),e=_.countBy(t),i=_.countBy(this.getEventsFacet(this.tgc2.getAvailableData().links));t=_.union(t);var n=[],a=[],s=this.select(".tgc2-facet-control-container");s.find(".nav-tabs>li.active>a").each(function(t,e){n.push($(e).attr("href"))}),this.select(".tgc2-facet-selected li").each(function(t,e){a.push($(e).attr("tag"))}),s.html('<div class="table-angle"><div class="table-angle-line1">数据</div><div class="table-angle-line2">条件</div></div><ul class="nav nav-tabs" role="tablist"></ul><div class="tab-content">'),t.reverse();for(var o in t){var r=_.split(t[o],"->"),l=s.children(".tab-content").children("#level1-"+r[0]);if(!l.length){var c="0"==o?"active":"";l=$('<div role="tabpanel" class="tab-pane '+c+'" id="level1-'+r[0]+'"><ul class="nav nav-tabs" role="tablist"></ul><div class="tab-content"></div></div>'),s.children(".tab-content").append(l),s.children(".nav").append('<li role="presentation" class="'+c+'"><a href="#level1-'+r[0]+'" role="tab" data-toggle="tab">'+this.settings.facetMap[r[0]]+"</a></li>");var d=s.children(".nav").children();d.width(Math.floor(100/d.length)+"%")}var h=l.find("#level2-"+r[1]);if(!h.length){var g=0==l.find(".nav").children().length?"active":"";h=$('<div role="tabpanel" class="tab-pane '+g+'" id="level2-'+r[1]+'"><ul class="clearfix"></ul></div>'),l.find(".tab-content").append(h),l.find(".nav").append('<li role="presentation" class="'+g+'"><a href="#level2-'+r[1]+'" role="tab" data-toggle="tab">'+r[1]+"</a></li>");var p=l.find(".nav").children();p.height(Math.floor(100/p.length)+"%")}var f=_.indexOf(a,t[o])>=0?"selected":"",u=$('<li class="tgc2-facet-filter-item '+f+'" tag="'+t[o]+'">'+r[2]+"（"+(i[t[o]]||0)+"/"+e[t[o]]+"）</li>");h.find("ul").append(u),_.indexOf(this.facet.brush.arrBrush,t[o])>=0&&u.css({"background-color":this.facet.brush.series.all[t[o]].fillColor})}for(var v in n)this.select('a[href="'+v+'"]').tab("show")},t.prototype.getEventsFacet=function(t){var e=_.union(_.map(t,"from"),_.map(t,"to")),i=_.filter(this.tgc2.getData().nodes,function(t){return _.indexOf(e,t.id)>=0&&t.facets});return _.flatten(_.map(i,"facets"))},t.prototype.initEvent=function(){var t=this;t.select(".ctrl-color").on("click",function(e){$(this).toggleClass("selected"),t.facet.brush.isBrush=!t.facet.brush.isBrush,t.brushColor(),e.stopPropagation()}),t.select(".tgc2-facet-control-title").on("click",function(){t.getContainer().toggleClass("on")}),t.select(".tgc2-facet-control-container").on("click",".tgc2-facet-filter-item",function(){var e=$(this).toggleClass("selected"),i=e.attr("tag");if(e.hasClass("selected")){var n=e.text().split("（"),a=$('<li tag="'+i+'">'+n[0]+'<svg height="12" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg></li>');t.select(".tgc2-facet-selected ul").append(a),"0"==n[1].split("/")[0]&&toastr.info("当前数据不在筛选时间段内，如需查看，请拖动扩大图谱底部时间轴覆盖范围。")}else t.removeFacetByTag(i);t.updateVisibleData(),t.settings.afterItemChange(t)}),t.select(".tgc2-facet-selected").on("click","li",function(){var e=$(this).attr("tag");t.removeFacetByTag(e),t.updateVisibleData(),t.settings.afterItemChange(t)}),t.select(".tgc2-facet-control-container").on("shown.bs.tab",'a[data-toggle="tab"]',function(){try{t.brushColor()}catch(e){$.noop()}})},t.prototype.initTemplate=function(){this.settings.enable&&(this.$container=$('<div class="tgc2-facet-control"><div class="tgc2-facet-control-title"><div class="ctrl-expend fl"><i class="arrow"></i></div><div class="ctrl-filter-off fl"><span class="fl">数据过多？尝试筛选及分类着色功能</span></div><div class="ctrl-filter fl"><div class="ctrl-filter-text fl"><div class="ctrl-filter-ent"></div><span>相关事件的筛选</span></div><div class="ctrl-color fl"><div class="btn-switch"><i></i></div><span>开启着色</span></div></div></div><div class="tgc2-facet-selected"><ul></ul><div class="detail"></div></div><div class="tgc2-facet-control-container"></div></div>'),this.$container.css({top:this.settings.style.top,right:this.settings.style.right,bottom:this.settings.style.bottom,left:this.settings.style.left,width:this.settings.style.width}),this.tgc2.getContainer().append(this.$container),this.initEvent())},t.prototype.onLoad=function(){var t=this.tgc2.getData();t.facetList&&t.facetList.length&&t.facetList.forEach(function(e){e.facetDetailList&&e.facetDetailList.length&&e.facetDetailList.forEach(function(i){var n=e.entityType+"->"+e.typeName+"->"+i.name;i.relNodeList.forEach(function(e){var i=_.find(t.nodes,function(t){return t.id==e});i.facets=i.facets||[],i.facets.push(n)}),i.relRelationList.forEach(function(e){var i=_.find(t.links,function(t){return t.id==e});i.facets=i.facets||[],i.facets.push(n)})})})},t.prototype.updateAuras=function(){for(var t=this.tgc2.getAvailableData().nodes,e=0,i=t;e<i.length;e++){var n=i[e];if(this.facet.brush.isBrush){if(n.facets){n.auras=[];for(var a=0,s=n.facets;a<s.length;a++){var o=s[a];_.indexOf(this.facet.brush.arrBrush,o)>=0&&n.auras.push(o)}}}else delete n.auras}},t.prototype.updateColor=function(){var t=this;t.select(".tgc2-facet-control-container>.tab-content>.tab-pane").each(function(e,i){$(i).find(".tab-pane").each(function(e,i){$(i).find("li").each(function(e,i){var n=$(i).attr("tag"),a=n.substring(0,n.lastIndexOf("->")),s=n.substring(n.lastIndexOf("->")+2);t.facet.brush.series[a]=t.facet.brush.series[a]||[];var o=_.find(t.facet.brush.series[a],["key",s]);if(!o){var r=t.settings.brush.color[_.size(t.facet.brush.series.all)%t.settings.brush.color.length],l={key:s,value:r};t.facet.brush.series[a].push(l),t.facet.brush.series.all=t.facet.brush.series.all||{},t.facet.brush.series.all[n]={fillColor:r,shadowColor:"rgba(254,248,17,0.6)",shadowBlur:35}}})})}),t.updateNodeBrush()},t.prototype.updateNodeBrush=function(){this.tgc2.netChart.updateSettings({auras:{style:this.facet.brush.series.all}})},t.prototype.updateVisibleData=function(){var t=this,e=[],i=[];t.select(".tgc2-facet-control-container>.tab-content>.tab-pane").each(function(n,a){var s=[],o=[];$(a).find(".tab-pane").each(function(e,i){var n=[],a=[];$(i).find("li.selected").each(function(e,i){var s=$(i).attr("tag"),o=s.split("->"),r=_.find(t.tgc2.getData().facetList,function(t){return t.entityType==o[0]&&t.typeName==o[1]}),l=_.find(r.facetDetailList,function(t){return t.name==o[2]});n=_.union(n,l.relNodeList),a=_.union(a,l.relRelationList)}),e>0?(s=_.xor(s,n),o=_.xor(o,a)):(s=n,o=a)}),e=_.union(e,s),i=_.union(i,o)});var n={nodes:e,links:i};this.tgc2.updateVisibleData(n),this.tgc2.updateChart()},t}();Tgc2Facet.defaultSettings={enable:!1,style:{top:"auto",right:"auto",bottom:"0",left:"0",width:"320px"},facetMap:[],brush:{color:["rgba(240,102,161,0.5)","rgba(189,171,242,0.5)","rgba(132,153,253,0.5)","rgba(161,162,164,0.5)","rgba(212,130,109,0.5)","rgba(249,176,143,0.5)","rgba(190,218,145,0.5)","rgba(185,211,206,0.5)","rgba(98,188,199,0.5)","rgba(253,187,231,0.5)","rgba(93,172,217,0.5)","rgba(134,203,253,0.5)","rgba(225,184,184,0.5)","rgba(218,170,118,0.5)","rgba(248,216,129,0.5)","rgba(114,187,131,0.5)","rgba(131,213,199,0.5)","rgba(101,145,150,0.5)"]},afterItemChange:$.noop};var Tgc2Filter=function(){function t(e,i){var n=this;this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addOnInitEvent(function(){n.initTemplate()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.getFilterOptions=function(){var t={};return this.tgc2.select(".tgc2-chart-filter-panel ul").each(function(e,i){var n=$(i).attr("data-name"),a=null;$(i).find('[type="radio"]').length>0?a=$(i).find('[type="radio"]:checked').val():(a=[],$(i).find('[type="checkbox"]:checked').each(function(t,e){a.push($(e).val())})),t[n]=a}),t},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){var t=this;this.select(".tgc2-chart-filter-panel").on("click",'[type="checkbox"]',function(){$(this).closest("label").toggleClass("checked")}),this.select(".tgc2-chart-filter-panel").on("click",'[type="checkbox"].selected-all',function(){var t=$(this).closest(".tgc2-chart-filter-title").next();t.find('[type="checkbox"]').prop("checked",this.checked),t.find("label").toggleClass("checked",this.checked)}),this.select(".tgc2-chart-filter-panel").on("click",'[type="radio"]',function(){$(this).closest("ul").find("label").removeClass("checked"),$(this).closest("label").addClass("checked")}),this.select(".btn-filter-preview").on("click",function(){t.tgc2.load(t.tgc2.getStartInfo())})},t.prototype.initTemplate=function(){if(this.settings.enable){var t='<svg height="30" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',e='<div class="tgc2-chart-filter-panel"><div class="tgc2-chart-filter-body">';e+='</div><div class="tgc2-chart-filter-foot"><button class="btn btn-primary btn-filter-preview">预览</button></div>',e+="</div>",this.tgc2.addRightPanel(t,e,"筛选过滤"),this.$container=this.tgc2.select(".tgc2-right-panels"),this.updateFilter(),this.initEvent()}},t.gentFilterItem=function(t){var e="",i=t.key,n="";if(t.selected instanceof Array){var a=t.key+(new Date).getTime();n='<ul class="tgc2-cr-box"><li><label for="'+a+'" class="checked"><div class="checkbox-img"></div><input id="'+a+'" class="selected-all" type="checkbox" checked>全选</label></li></ul>'}e+='<div class="tgc2-chart-filter-title">'+t.label+n+'</div><div class="tgc2-chart-filter-content"><ul class="clearfix tgc2-cr-box" data-name="'+i+'">';var s=i+"-"+(new Date).getTime();for(var o in t.options){var a=s+"-"+o,r="",l="",c="";t.options instanceof Array?(c=t.options[o],l=t.options[o],c instanceof Object&&(l=t.options[o].label,c=t.options[o].value)):(c=o,l=t.options[o]),t.selected instanceof Array?(_.indexOf(t.selected,c)!=-1&&(r="checked"),e+='<li><label for="'+a+'" class="'+r+'"><div class="checkbox-img"></div><input id="'+a+'" type="checkbox" '+r+' value="'+c+'" name="'+s+'">'+l+"</label></li>"):(t.selected==c&&(r="checked"),e+='<li><label for="'+a+'" class="'+r+'"><div class="radio-img"></div><input id="'+a+'" type="radio" '+r+' value="'+c+'" name="'+s+'">'+l+"</label></li>")}return e+="</ul></div>"},t.prototype.updateFilter=function(){var e="";for(var i in this.settings.filters)e+=t.gentFilterItem(this.settings.filters[i]);this.select(".tgc2-chart-filter-body").html(e)},t}();Tgc2Filter.filters=[],Tgc2Filter.defaultSettings={enable:!1,filters:Tgc2Filter.filters};var Tgc2Find=function(){function t(e,i){var n=this;this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addOnInitEvent(function(){n.initTemplate()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){var t=this,e={container:".tgc2-find",placeholder:"定位图中节点",onPrompt:function(e){for(var i=t.tgc2.netChart.nodes(),n=[],a=0,s=i;a<s.length;a++){var o=s[a];_.lowerCase(o.data.name).indexOf(_.lowerCase(e))>=0&&n.push(o.data)}t.find.startDrawPromptItems(n,e)},onSearch:function(e){t.tgc2.netChart.scrollIntoView([t.tgc2.netChart.getNode(e.id)])}};this.find=new hieknPrompt(e)},t.prototype.initTemplate=function(){if(this.settings.enable){var t='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="30" height="30"><path d="M522.766205 498.146481m-55.177694 0a53.921 53.921 0 1 0 110.355387 0 53.921 53.921 0 1 0-110.355387 0Z"></path><path d="M874.757954 461.809901c-17.229406-165.945473-146.970306-298.455439-311.618227-319.931566l0-78.426187-80.748069 0 0 76.940346C311.401286 156.212808 175.011966 291.369044 157.315932 461.809901L67.88511 461.809901l0 80.748069 90.046852 0c19.980054 167.894871 155.275459 300.380278 324.46072 316.033793l0 93.090165 80.748069 0 0-94.576005c162.861228-21.243837 291.555286-151.129023 311.002197-314.548976l81.971943 0 0-80.748069L874.757954 461.808878zM803.37416 542.55797c-18.519796 124.621299-116.176976 223.404116-240.23341 243.632833L563.140751 647.529743l-80.748069 0 0 140.53064C351.990726 773.019829 247.885693 671.65214 228.700749 542.55797l143.335523 0 0-80.748069L227.947596 461.809901c17.052374-131.651412 122.235972-235.636718 254.445086-250.886027l0 137.839345 80.748069 0L563.140751 212.793454c125.836987 20.519336 224.517473 121.863489 240.986563 249.015424L670.804842 461.808878l0 80.748069L803.37416 542.556946z"></path></svg>',e='<div class="tgc2-find-container"><div class="tgc2-find"></div></div>';this.tgc2.addFloatPanel(t,e,"定位"),this.$container=this.tgc2.select(".tgc2-float-panels"),this.initEvent()}},t}();Tgc2Find.defaultSettings={enable:!1};var Tgc2Legend=function(){function t(e,i){var n=this;this.defaultSettings={enable:!1,style:{},legendDraw:function(t,e){n.legendDraw(t,e)},itemDraw:t.itemDraw,data:[]},this.tgc2=e,this.settings=$.extend(!0,{},this.defaultSettings,i),this.settings.enable&&(this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addOnChartUpdate(function(){n.updateLegend()}))}return t.prototype.legendDraw=function(t,e){e.html("");for(var i in t){var n=$('<div class="tgc2-legend-item tgc2-legend-item-'+i+'"></div>').data({key:i,value:t[i]}),a=n.html(this.settings.itemDraw(i,t[i]));e.append(a)}},t.prototype.updateLegend=function(){this.settings.legendDraw(this.settings.data,this.getContainer())},t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){var t=this;this.getContainer().on("click",".tgc2-legend-item",function(e){t.settings.onClick&&t.settings.onClick(e)}),this.getContainer().on("mouseenter",".tgc2-legend-item",function(e){t.settings.onMouseEnter&&t.settings.onMouseEnter(e)}),this.getContainer().on("mouseleave",".tgc2-legend-item",function(e){t.settings.onMouseLeave&&t.settings.onMouseLeave(e)}),this.getContainer().on("dblclick",".tgc2-legend-item",function(e){t.settings.onDblClick&&t.settings.onDblClick(e)})},t.prototype.initTemplate=function(){this.$container=$('<div class="tgc2-legend"></div>'),this.$container.css({top:this.settings.style.top,right:this.settings.style.right,bottom:this.settings.style.bottom,left:this.settings.style.left}),this.tgc2.getMainContainer().append(this.$container),this.initEvent()},t.itemDraw=function(t,e){return'<i style="background: '+e+'"></i><span>'+e+"</span>"},t}(),Tgc2Page=function(){function t(e,i){var n=this;this.isPageEvent=!1,this.page={pageNo:1,pageSize:10,hasNext:!0},this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addOnLoad(function(){return n.onLoad()}),this.tgc2.addBeforeLoad(function(){n.beforeLoad()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.beforeLoad=function(){this.isPageEvent||(this.page.pageNo=1,this.page.hasNext=!0)},t.prototype.initEvent=function(){var t=this;this.select('select[name="pageSize"]').on("change",function(e){t.isPageEvent=!0,t.page.pageSize=parseInt(e.target.value,10),t.page.pageNo=1,t.tgc2.load(t.tgc2.startInfo)}),this.select(".btn-prev-page").on("click",function(){t.page.pageNo>1?(t.isPageEvent=!0,t.page.pageNo=t.page.pageNo-1,t.tgc2.load(t.tgc2.startInfo)):toastr.info("当前已经是第一页了")}),this.select(".btn-next-page").on("click",function(){t.page.hasNext?(t.isPageEvent=!0,t.page.pageNo=t.page.pageNo+1,t.tgc2.load(t.tgc2.startInfo)):toastr.info("没有更多内容了")})},t.prototype.initTemplate=function(){this.settings.enable&&(this.$container=$('<div class="tgc2-page-container btn-float-group"><button class="btn btn-float btn-prev-page"><svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"/><path d="M0-.5h24v24H0z" fill="none"/></svg></button><div class="btn-float page-size-container">每页 <select name="pageSize"><option value="10">10</option><option value="20">20</option><option value="30">30</option></select></div><button class="btn btn-float btn-next-page"><svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"/><path d="M0-.25h24v24H0z" fill="none"/></svg></button></div>'),this.tgc2.getMainContainer().append(this.$container),this.getContainer().css({top:this.settings.style.top,right:this.settings.style.right,bottom:this.settings.style.bottom,left:this.settings.style.left}),this.select('select[name="pageSize"]').val(this.settings.pageSize),this.page.pageSize=this.settings.pageSize,this.page.pageNo=this.settings.pageNo,this.initEvent())},t.prototype.onLoad=function(){var t=this.tgc2.getData();this.isPageEvent=!1,t.nodes.length<this.page.pageSize&&(this.page.hasNext=!1)},t}();Tgc2Page.defaultSettings={style:{top:"20px",right:"245px",bottom:"auto",left:"auto"},enable:!1,pageNo:1,pageSize:10};var Tgc2Prompt=function(){function t(t,e){var i=this;this.defaultSettings={enable:!1,style:{top:"20px",right:"auto",bottom:"50px",left:"15px",maxWidth:"320px"},settings:{container:".tgc2-prompt",onSearch:function(t){t&&i.tgc2.load(t)}}},this.tgc2=t,this.settings=$.extend(!0,{},this.defaultSettings,e),this.tgc2.addOnInitEvent(function(){i.initTemplate()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){this.prompt=new hieknPrompt(this.settings.settings)},t.prototype.initTemplate=function(){this.settings.enable&&(this.$container=$('<div class="tgc2-prompt"></div>'),this.settings.settings.container=this.$container,this.$container.css({top:this.settings.style.top,right:this.settings.style.right,bottom:this.settings.style.bottom,left:this.settings.style.left,maxWidth:this.settings.style.maxWidth}),this.tgc2.getMainContainer().append(this.$container),this.initEvent())},t}(),Tgc2Stats=function(){function t(e,i){var n=this;this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addBeforeDraw(function(){return n.beforeDraw()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.initEvent=function(){var t=this;t.getContainer().on("mouseenter",".tgc2-stats-ul>li",function(){var e=[$(this).data("node")];t.tgc2.setEmphasesNode(e),t.tgc2.netChart.updateStyle()}),t.getContainer().on("mouseleave",".tgc2-stats-ul>li",function(){t.tgc2.clearEmphasesNode(),t.tgc2.netChart.updateStyle()})},t.prototype.initTemplate=function(){if(this.settings.enable){var t="图统计",e='<div class="tgc2-stats"></div>';this.tgc2.addLeftPanel("",e,t),this.$container=this.tgc2.select(".tgc2-left-panels"),this.initEvent()}},t.prototype.beforeDraw=function(){var t=this.tgc2.getData();this.drawData(t)},t.prototype.drawData=function(t){var e=t.stats;this.select(".tgc2-stats").empty();var i="";if(e&&e.length)for(var n=function(e){var n=$('<div class="tgc2-stats-content"><div class="tgc2-stats-subtitle">'+e.key+'</div><ul class="tgc2-stats-ul"></ul></div>');e.rs&&e.rs.length?(e.rs=_.orderBy(e.rs,["count"],["desc"]),e.rs.forEach(function(e,i){var a=_.find(t.nodes,function(t){return t.id==e.id}),s=$('<li><i class="tgc2-stats-no tgc2-stats-no-'+(i+1)+'">'+(i+1)+'</i><span class="name">'+a.name+'</span><span class="num">'+e.count+"</span></li>");s.data("node",e.id),n.find(".tgc2-stats-ul").append(s)}),a.select(".tgc2-stats").append(n)):i='<div class="no-data">暂无数据</div>'},a=this,s=0,o=e;s<o.length;s++){var r=o[s];n(r)}else i='<div class="no-data">暂无数据</div>';i&&this.select(".tgc2-stats").append(i)},t}();Tgc2Stats.defaultSettings={enable:!1};var Tgc2TimeChart=function(){function t(e,i){var n=this;this.times=[],this.counts=[],this.events=[],this.visibleEvents=[],this.start=null,this.end=null,this.timeFilterSettings={},this.tgc2=e,this.settings=$.extend(!0,{},t.defaultSettings,i),this.tgc2.addBeforeDraw(function(){n.beforeDraw()}),this.tgc2.addOnInitEvent(function(){n.initTemplate()}),this.tgc2.addOnResize(function(){n.timeChart&&n.timeChart.resize()})}return t.prototype.getContainer=function(){return this.$container},t.prototype.getSettings=function(){return this.timeFilterSettings},t.prototype.select=function(t){return this.getContainer().find(t)},t.prototype.beforeDraw=function(){this.buildEvents(),this.drawTimeChart()},t.prototype.buildEvents=function(){var e=this.tgc2.getData();if(this.events=t.updateEventInfo(e.links),e.computerTime){this.start=e.computerTime;var i=new Date(this.start).getTime();this.visibleEvents=_.filter(this.events,function(t){return!t.hidden&&t.timestamp>=i})}else{this.visibleEvents=this.events;var n=_.minBy(this.visibleEvents,"timestamp");this.start=n?n.time:t.today()}this.tgc2.start=this.start;var a=_.maxBy(this.visibleEvents,"timestamp");this.end=a?a.time:t.today(),this.tgc2.end=this.end,this.buildAvailableData(e)},t.prototype.buildAvailableData=function(t){for(var e=$.extend(!0,{},t),i=_.union(_.map(this.visibleEvents,"from"),_.map(this.visibleEvents,"to")),n=[],a=0,s=e.nodes;a<s.length;a++){var o=s[a];(_.indexOf(i,o.id)>=0||this.tgc2.inStart(o.id))&&n.push(o)}e.nodes=n;for(var r=_.map(this.visibleEvents,"id"),l=[],c=0,d=e.links;c<d.length;c++){var h=d[c];_.indexOf(r,h.id)>=0&&l.push(h)}e.links=l,this.tgc2.updateAvailableData(e)},t.prototype.drawTimeChart=function(){var t=_.countBy(this.events,"time"),e=[];for(var i in t)e.push({key:i,value:t[i]});var n=_.orderBy(e,["key"],["asc"]);this.times=_.map(n,"key"),this.counts=_.map(n,"value"),this.getContainer().removeClass("in-play"),this.showStaticTimeChart()},t.prototype.showStaticTimeChart=function(){var t=this;this.timeChart&&this.timeChart.dispose();var e=this.select(".tgc2-timechart");this.timeChart=echarts.init(e[0]);var i=this.settings.settings;i.xAxis[0].data=this.times,i.dataZoom[0].startValue=this.tgc2.getData().computerTime||this.times[0],i.dataZoom[0].endValue=this.times.length-1,i.series[0].data=this.counts,this.timeChart.setOption(i),this.timeChart.on("datazoom",function(){var e=t.timeChart.getOption().dataZoom[0];t.start=t.times[e.startValue],t.tgc2.start=t.start,t.end=t.times[e.endValue],t.tgc2.end=t.end;var i=new Date(t.start).getTime(),n=new Date(t.end).getTime();t.visibleEvents=_.filter(t.events,function(t){return t.timestamp>=i&&t.timestamp<=n});var a=t.tgc2.getData();t.buildAvailableData(a),t.tgc2.updateChart()})},t.prototype.showDynamicTimeChart=function(){var t=this;this.timeChart&&this.timeChart.dispose();var e=this.select(".tgc2-timechart");this.timeChart=echarts.init(e[0]);var i=this.settings.timelineSettings;i.timeline.data=this.times,this.timeChart.setOption(i),this.timeChart.on("timelinechanged",function(e){t.start=t.times[e.currentIndex],t.tgc2.start=t.start,t.end=t.times[e.currentIndex],t.tgc2.end=t.end;var i=new Date(t.start).getTime(),n=new Date(t.end).getTime();t.visibleEvents=_.filter(t.events,function(t){return t.timestamp>=i&&t.timestamp<=n});var a=t.tgc2.getData();t.buildAvailableData(a),t.tgc2.updateChart()})},t.prototype.initEvent=function(){var t=this;this.getContainer().find(".tgc2-timechart-control").on("click",function(t){$(t.target).closest(".tgc2-timechart-container").toggleClass("hide-detail")}),this.getContainer().find(".tgc2-timechart-play").on("click",function(e){$(e.target).closest(".tgc2-timechart-container").addClass("in-play"),t.showDynamicTimeChart()}),this.getContainer().find(".tgc2-timechart-stop").on("click",function(e){$(e.target).closest(".tgc2-timechart-container").removeClass("in-play"),t.showStaticTimeChart()}),this.getContainer().find(".tgc2-timechart-setting").on("click",function(){t.$settingModal.modal({backdrop:"static"})}),this.$settingModal.find(".btn-tgc2-setting").on("click",function(){t.updateSettings()&&(t.tgc2.load(t.tgc2.startInfo),t.$settingModal.modal("hide"))}),this.$settingModal.on("click",'[type="radio"]',function(){$(this).closest("ul").find("label").removeClass("checked"),$(this).closest("label").addClass("checked")}),this.$settingModal.on("click",'tr:first-child [type="radio"]',function(e){var i=$(e.target).closest("label").find("input").val();t.$settingModal.find("tr:eq("+i+")").removeClass("hide").siblings("tr:gt(0):not(:eq("+i+"))").addClass("hide")})},t.prototype.initTemplate=function(){this.settings.enable&&(this.$container=$('<div class="tgc2-timechart-container hide-detail"><div class="tgc2-timechart-controls"><button class="tgc2-timechart-setting btn btn-primary tgc2-tooltip-container"><div class="tgc2-tooltip tgc2-tooltip-top"><div class="tgc2-tooltip-box">设置</div><div class="tgc2-tooltip-arrow"></div></div><svg height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg></button><span class="tgc2-timechart-split"></span><button class="tgc2-timechart-play btn btn-primary"><svg height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></button><button class="tgc2-timechart-stop btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="20" width="20"><path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8S16.4,20,12,20z"></path><path d="M15,16H9c-0.6,0-1-0.5-1-1V9c0-0.5,0.4-1,1-1h6c0.6,0,1,0.5,1,1v6C16,15.6,15.6,16,15,16z"></path></svg></button><span class="tgc2-timechart-split"></span><button class="tgc2-timechart-control btn btn-primary"><svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/><path d="M0 0h24v24H0z" fill="none"/></svg></button></div><div class="tgc2-timechart-chart-container"><div class="tgc2-timechart"></div></div></div>'),this.namePrefix="tgc2SettingModal-"+Math.random(),this.$settingModal=$('<div class="modal fade tgc2-settings-modal" id="'+this.namePrefix+'" tabindex="-1" role="dialog" aria-labelledby="'+this.namePrefix+'Label"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="'+this.namePrefix+'Label">展示设置</h4></div><div class="modal-body"><table class="tgc2-settings-table tgc2-cr-box"><tr><td>展示限制</td><td><ul><li><label for="'+this.namePrefix+'-num" class="checked"><div class="radio-img"></div><input id="'+this.namePrefix+'-num" type="radio" checked value="1" name="'+this.namePrefix+'-type">事件数量</label></li><li><label for="'+this.namePrefix+'-time"><div class="radio-img"></div><input id="'+this.namePrefix+'-time" type="radio" value="2" name="'+this.namePrefix+'-type">时间跨度</label></li></ul></td></tr><tr><td>事件数量</td><td><ul><li><label for="'+this.namePrefix+'-num-20" class="checked"><div class="radio-img"></div><input id="'+this.namePrefix+'-num-20" type="radio" checked value="20" name="'+this.namePrefix+'-num">最近20条</label></li><li><label for="'+this.namePrefix+'-num-40"><div class="radio-img"></div><input id="'+this.namePrefix+'-num-40" type="radio" value="40" name="'+this.namePrefix+'-num">最近40条</label></li><li><label for="'+this.namePrefix+'-num-80"><div class="radio-img"></div><input id="'+this.namePrefix+'-num-80" type="radio" value="80" name="'+this.namePrefix+'-num">最近80条</label></li><li><label for="'+this.namePrefix+'-num-0"><div class="radio-img"></div><input id="'+this.namePrefix+'-num-0" type="radio" value="0" name="'+this.namePrefix+'-num">自定义<input type="number" value="100" class="form-control" name="'+this.namePrefix+'-num-diy">条</label></li></ul><div class="tgc2-setting-tip"></div></td></tr><tr class="hide"><td>时间范围</td><td><div class="input-daterange"><input type="date" placeholder="开始时间" class="form-control" name="'+this.namePrefix+'-from"><div class="tgc2-setting-date-split"></div><input type="date" placeholder="截止时间" class="form-control" name="'+this.namePrefix+'-to"></div><div class="tgc2-setting-tip"></div></td></tr></table></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary btn-tgc2-setting">确定</button></div></div></div></div>'),this.$container.css({top:this.settings.style.top,right:this.settings.style.right,bottom:this.settings.style.bottom,left:this.settings.style.left}),this.tgc2.select(".tgc2-netchart-container").append(this.$container),$("body").append(this.$settingModal),this.initEvent(),this.updateSettings())},t.today=function(){var t=new Date,e=t.getMonth()+1+"";e.length<2&&(e=0+e);var i=t.getDate()+"";return i.length<2&&(i=0+i),t.getFullYear()+"-"+e+"-"+i},t.updateEventInfo=function(t){for(var e=[],i=0,n=t;i<n.length;i++)for(var a=n[i],s=0,o=a.bsTime;s<o.length;s++){
var r=o[s],l=$.extend(!0,{},a),c=new Date(r);l.time=r,l.timestamp=c.getTime(),e.push(l)}return e},t.prototype.updateSettings=function(){var e=this.$settingModal.find('[name="'+this.namePrefix+'-type"]:checked').val();if("1"==e){var i=this.$settingModal.find('[name="'+this.namePrefix+'-num"]:checked').val();if(0==i&&(i=this.$settingModal.find('[name="'+this.namePrefix+'-num-diy"]').val()),i=_.parseInt(i,10),!i)return this.$settingModal.find(".tgc2-setting-tip:visible").text("*请输入正确的数字"),!1;this.timeFilterSettings.pageSize=i,this.timeFilterSettings.fromTime="",this.timeFilterSettings.toTime=t.today()}else if("2"==e){var n=this.$settingModal.find('[name="'+this.namePrefix+'-from"]').val(),a=this.$settingModal.find('[name="'+this.namePrefix+'-to"]').val();if(!n||!a)return this.$settingModal.find(".tgc2-setting-tip:visible").text("*开始时间和截止时间不能为空"),!1;this.timeFilterSettings.pageSize="0",this.timeFilterSettings.fromTime=n,this.timeFilterSettings.toTime=a}return this.timeFilterSettings.type=e,!0},t}();Tgc2TimeChart.defaultSettings={enable:!1,style:{top:"auto",right:"30px",bottom:"0",left:"15px"},settings:{color:["#00b38a"],tooltip:{trigger:"item"},grid:{left:"90px",right:"60px",top:"10px",bottom:"50px",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,interval:0}],yAxis:[{type:"value",splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!1}}],dataZoom:[{show:!0,realtime:!0,fillerColor:"rgba(0, 179, 138, 0.3)",labelFormatter:"{value}\n\n\n\n"}],series:[{name:"事件总量",type:"line",stack:"数量",symbolSize:5,areaStyle:{normal:{}}}]},timelineSettings:{timeline:{axisType:"category",autoPlay:!0,currentIndex:-1,playInterval:3e3,checkpointStyle:{color:"#00b38a",borderColor:"rgba(0,179,138,0.3)"},controlStyle:{emphasis:{color:"#00b38a",borderColor:"#00b38a"}},label:{normal:{textStyle:{}},emphasis:{textStyle:{color:"#00b38a"}}},itemStyle:{emphasis:{color:"#00b38a"}}}}};