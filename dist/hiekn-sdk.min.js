/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v0.2.0
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

!function(t,e){"use strict";function n(){var n=function(n){var i=this;i.isInit=!1,i.sdkUtils=new t.HieknSDKService(n),i.sdkUtils.schema(n,function(t){var a=i.sdkUtils.buildFilter(t,n);a=[{key:"distance",label:"设定显示层数",selected:1,options:[1,2,3]}].concat(a);var s={selector:n.selector,prompt:{enable:!0,style:{left:"20px",top:"40px"},settings:{drawPromptItem:i.sdkUtils.drawPromptItem(t),onPrompt:i.sdkUtils.onPrompt(n)}},page:{style:{right:"10px",bottom:"20px"},enable:!0,pageSize:20},netChart:{filter:{enable:!0,filters:a},settings:{nodeMenu:{contentsFunction:i.sdkUtils.infobox()}}},loader:i.sdkUtils.graph(n),schema:t};i.options=e.extend(!0,{},s,n.graphSetting),i.sdkUtils.gentInfobox(n.selector||n.graphSetting.selector),i.init()})};return n.prototype.init=function(){var t=this;t.tgc2=new Tgc2Graph(t.options),t.tgc2Filter=new Tgc2Filter(t.tgc2),t.tgc2Prompt=new Tgc2Prompt(t.tgc2),t.tgc2Page=new Tgc2Page(t.tgc2),t.sdkUtils.updateSettings({tgc2:t.tgc2,tgc2Filter:t.tgc2Filter,tgc2Page:t.tgc2Page}),t.tgc2.init(),t.isInit=!0},n.prototype.load=function(t){var e=this;setTimeout(function(){e.isInit?e.tgc2.load(t):e.load(t)},30)},n}t.HieknGraphService=n()}(window,jQuery),function(t,e){"use strict";function n(){var t=function(t){var n=this,i={selector:null,data:null,baseUrl:null,kgName:null,enableLink:!1,href:null};n.settings=e.extend(!0,{},i,t)};return t.prototype.href=function(t){var e=this;e.load(t,e.callback)},t.prototype.initEvent=function(t){var n=this;t.on("click",".hiekn-infobox-link",function(){var t=e(this).attr("data-id");n.settings.href?n.settings.href(t,n):n.href(t)}),t.on("click",".hiekn-infobox-info-detail a",function(){e(this).closest(".hiekn-infobox-info-detail").toggleClass("on")})},t.prototype.buildEntity=function(t,e){var n=this,i=t.meaningTag?"("+t.meaningTag+")":"",a='<span class="hiekn-infobox-name">'+t.name+'<span class="hiekn-infobox-meaningTag">'+i+"</span></span>";return e&&n.settings.enableLink?'<a href="javascript:void(0)" class="hiekn-infobox-link" data-id="'+t.id+'">'+a+"</a>":a},t.prototype.buildExtra=function(t){var e=t.v||"-";return t.v.length>80&&(e='<span class="hiekn-infobox-info-detail-short">'+t.v.substring(0,56)+'<a href="javascript:void(0)">查看全部&gt;&gt;</a></span><span class="hiekn-infobox-info-detail-long">'+t.v+'<a href="javascript:void(0)">收起&lt;&lt;</a></span>'),'<tr><td class="hiekn-infobox-info-label">'+t.k+'</td><td class="hiekn-infobox-info-detail">'+e+"</td></tr>"},t.prototype.load=function(t,n){var i=this,a=i.settings.data||{};a.id=t,a.kgName=i.settings.kgName,hieknjs.kgLoader({url:i.settings.baseUrl+"infobox",type:1,params:a,success:function(t){if(t&&t.rsData&&t.rsData.length){var a=t.rsData[0];if(n)i.callback=n,n(a);else if(i.settings.selector){var s=i.buildInfobox(a);e(i.settings.selector).html(s),i.initEvent(s)}else console.error("selector or callback must be config")}},error:function(){toastr.error("网络接口错误！")}})},t.prototype.buildInfobox=function(t){var n=this,i=e('<div class="hiekn-infobox"></div>');if(t.self){i.append('<div class="hiekn-infobox-head"></div><div class="hiekn-infobox-body"></div>');var a=n.buildEntity(t.self,!1);if(i.find(".hiekn-infobox-head").append('<div class="hiekn-infobox-title">'+a+"</div>"),t.self.extra){var s="";for(var o in t.self.extra){var r=t.self.extra[o];s+=n.buildExtra(r)}if(t.atts)for(var l in t.atts)if(t.atts.hasOwnProperty(l)){var c=t.atts[l],d="";for(var p in c.v){var f=c.v[p],a=n.buildEntity(f,!0);d+="<li>"+a+"</li>"}s+='<tr><td class="hiekn-infobox-info-label">'+c.k+'</td><td class="hiekn-infobox-info-detail">'+d+"</td></tr>"}i.find(".hiekn-infobox-body").append("<table><tbody>"+s+"</tbody></table>")}if(t.pars){i.find(".hiekn-infobox-head").append('<div class="hiekn-infobox-pars"><label class="hiekn-infobox-label">所属：</label><ul></ul></div>');for(var g in t.pars){var f=t.pars[g],a=n.buildEntity(f,!0);i.find(".hiekn-infobox-pars ul").append("<li>"+a+"</li>")}}if(t.sons){var s="";for(var u in t.sons){var f=t.sons[u],a=n.buildEntity(f,!0);s+="<li>"+a+"</li>"}i.find(".hiekn-infobox-head").append('<div class="hiekn-infobox-pars"><label class="hiekn-infobox-label">相关：</label><ul>'+s+"</ul></div>")}}else i.append("InfoBox读取错误");return i},t.prototype.buildTabInfobox=function(t){var n=this,i=e('<div class="hiekn-infobox hiekn-infobox-tab"></div>');if(t.self){i.append('<div class="hiekn-infobox-head"></div><div class="hiekn-infobox-body"><ul class="nav nav-tabs" role="tablist"></ul><div class="tab-content"></div></div>');var a=n.buildEntity(t.self,!1);if(i.find(".hiekn-infobox-head").append('<div class="hiekn-infobox-title">'+a+"</div>"),t.self.extra){var s="";for(var o in t.self.extra){var r=t.self.extra[o];s+=n.buildExtra(r)}var l="hiekn-infobox-"+(new Date).getTime()+"-"+t.self.id;i.find(".hiekn-infobox-body>.nav-tabs").append('<li role="presentation" class="active"><a href="#'+l+'" role="tab" data-toggle="tab" aria-expanded="true">基本信息</a></li>'),i.find(".hiekn-infobox-body>.tab-content").append('<div role="tabpanel" class="tab-pane-detail tab-pane active" id="'+l+'"><table><tbody>'+s+"</tbody></table></div>")}if(t.pars){i.find(".hiekn-infobox-head").append('<div class="hiekn-infobox-pars"><label class="hiekn-infobox-label">所属：</label><ul></ul></div>');for(var c in t.pars){var d=t.pars[c],a=n.buildEntity(d,!0);i.find(".hiekn-infobox-pars ul").append("<li>"+a+"</li>")}}if(t.sons){var s="";for(var p in t.sons){var d=t.sons[p],a=n.buildEntity(d,!0);s+="<li>"+a+"</li>"}var l="hiekn-infobox-"+(new Date).getTime()+"-sons-"+t.self.id;i.find(".hiekn-infobox-body>.nav-tabs").append('<li role="presentation"><a href="#'+l+'" role="tab" data-toggle="tab" aria-expanded="true">子节点</a></li>'),i.find(".hiekn-infobox-body>.tab-content").append('<div role="tabpanel" class="tab-pane-sons tab-pane" id="'+l+'"><ul>'+s+"</ul></div>")}if(t.atts)for(var f in t.atts)if(t.atts.hasOwnProperty(f)){var g=t.atts[f],s="";for(var u in g.v){var d=g.v[u],a=n.buildEntity(d,!0);s+="<li>"+a+"</li>"}var l="hiekn-infobox-"+(new Date).getTime()+"-att-"+f+"-"+t.self.id;i.find(".hiekn-infobox-body>.nav-tabs").append('<li role="presentation"><a href="#'+l+'" role="tab" data-toggle="tab" aria-expanded="true">'+g.k+"</a></li>"),i.find(".hiekn-infobox-body>.tab-content").append('<div role="tabpanel" class="tab-pane-sons tab-pane" id="'+l+'"><ul>'+s+"</ul></div>")}}else i.append("InfoBox读取错误");return i},t}t.HieknInfoboxService=n()}(window,jQuery),function(t,e){"use strict";function n(){var n=function(n){var i=this;i.isInit=!1,i.sdkUtils=new t.HieknSDKService(n),i.sdkUtils.schema(n,function(t){var a=i.sdkUtils.buildFilter(t,n);a=[{key:"distance",label:"设定分析步长",selected:3,options:[3,4,5,6]}].concat(a);var s={selector:n.selector,netChart:{style:{left:"320px"},filter:{enable:!0,filters:a},settings:{nodeMenu:{contentsFunction:i.sdkUtils.infobox()}}},stats:{enable:!0},connects:{enable:!0},loader:i.sdkUtils.path(n),schema:t,path:{prompt:{settings:{drawPromptItem:i.sdkUtils.drawPromptItem(t),onPrompt:i.sdkUtils.onPrompt(n)}}}};i.options=e.extend(!0,{},s,n.pathSetting),i.sdkUtils.gentInfobox(n.selector||n.pathSetting.selector),i.init()})};return n.prototype.init=function(){var t=this;t.tgc2=new Tgc2Path(t.options),t.tgc2Filter=new Tgc2Filter(t.tgc2),t.tgc2Stats=new Tgc2Stats(t.tgc2),t.tgc2Connects=new Tgc2Connects(t.tgc2),t.sdkUtils.updateSettings({tgc2:t.tgc2,tgc2Filter:t.tgc2Filter}),t.tgc2.init(),t.isInit=!0},n.prototype.load=function(t){var e=this;setTimeout(function(){e.isInit?e.tgc2.load(t):e.load(t)},30)},n}t.HieknPathService=n()}(window,jQuery),function(t,e){"use strict";function n(){var t=function(t){var n=this,i={selector:null,data:null,url:null,kgName:null,ready:e.noop};n.settings=e.extend(!0,{},i,t),n.init()};return t.prototype.init=function(){var t=this,n=new HieknSDKService(t.settings);n.schema(t.settings,function(i){var a={drawPromptItem:n.drawPromptItem(i),onPrompt:n.onPrompt(t.settings)};e.extend(!0,a,t.settings);var s=new hieknPrompt(a);t.settings.ready(s)})},t}t.HieknPromptService=n()}(window,jQuery),function(t,e){"use strict";function n(){var n=function(n){var i=this;i.isInit=!1,i.sdkUtils=new t.HieknSDKService(n),i.sdkUtils.schema(n,function(t){var a=i.sdkUtils.buildFilter(t,n);a=[{key:"distance",label:"设定分析步长",selected:3,options:[3,4,5,6]}].concat(a);var s={selector:n.selector,netChart:{style:{left:"320px"},filter:{enable:!0,filters:a},settings:{nodeMenu:{contentsFunction:i.sdkUtils.infobox()}}},stats:{enable:!0},connects:{enable:!0},loader:i.sdkUtils.relation(n),schema:t,relation:{prompt:{settings:{drawPromptItem:i.sdkUtils.drawPromptItem(t),onPrompt:i.sdkUtils.onPrompt(n)}}}};i.options=e.extend(!0,{},s,n.relationSetting),i.sdkUtils.gentInfobox(n.selector||n.relationSetting.selector),i.init()})};return n.prototype.init=function(){var t=this;t.tgc2=new Tgc2Relation(t.options),t.tgc2Filter=new Tgc2Filter(t.tgc2),t.tgc2Stats=new Tgc2Stats(t.tgc2),t.tgc2Connects=new Tgc2Connects(t.tgc2),t.sdkUtils.updateSettings({tgc2:t.tgc2,tgc2Filter:t.tgc2Filter}),t.tgc2.init(),t.isInit=!0},n.prototype.load=function(t){var e=this;setTimeout(function(){e.isInit?e.tgc2.load(t):e.load(t)},30)},n}t.HieknRelationService=n()}(window,jQuery),function(){function t(){var t=function(t){var e={data:{},baseUrl:null,tgc2:null,tgc2Filter:null,tgc2Page:null};this.settings=$.extend(!0,{},e,t)};return t.prototype.updateSettings=function(t){$.extend(!0,this.settings,t)},t.prototype.drawPromptItem=function(t){var e={};for(var n in t.types){var i=t.types[n];e[i.k]=i.v}return function(t,n){var i='<span class="prompt-tip-title">'+t.name.replace(new RegExp("("+n+")","gi"),'<span class="highlight">$1</span>')+"</span>";return i='<span class="prompt-tip-type prompt-tip-'+t.classId+'">'+(e[t.classId]||"")+"</span>"+i}},t.prototype.onPrompt=function(t){var e=this;return function(n,i){var a=t.data||{};a.kgName=t.kgName,a.kw=n,hieknjs.kgLoader({url:e.settings.baseUrl+"prompt",params:a,type:1,success:function(t){if(i.prompt==a.kw){var e=t.rsData;i.startDrawPromptItems(e,n)}}})}},t.prototype.schema=function(t,e){var n=this,i=t.data||{};i.kgName=t.kgName,hieknjs.kgLoader({url:n.settings.baseUrl+"schema",type:1,params:i,success:function(t){if(t&&t.rsData&&t.rsData.length){var n=t.rsData[0];e(n)}},error:function(){toastr.error("网络接口错误！")}})},t.prototype.gentInfobox=function(t){var e=this;e.infoboxService=new HieknInfoboxService({baseUrl:e.settings.baseUrl,kgName:e.settings.kgName,data:{isRelationAtts:!0}}),e.infoboxService.initEvent($(t))},t.prototype.infobox=function(){var t=this;return function(e,n,i){return n.detail?i(n.detail):t.infoboxService.load(e.id,function(e){e=t.infoboxService.buildInfobox(e)[0].outerHTML,n.detail=e,i(e)}),null}},t.prototype.buildFilter=function(t,e){var n=[],i=[],a=[],s=[];for(var o in t.atts){var r=t.atts[o];1==r.type&&(n.push({value:r.k,label:r.v}),i.push(r.k))}for(var l in t.types){var c=t.types[l];a.push({value:c.k,label:c.v}),s.push(c.k)}return i=e.selectedAtts||i,s=e.selectedTypes||s,[{key:"allowTypes",label:"设定分析主体",selected:s,options:a},{key:"allowAtts",label:"设定分析关系",selected:i,options:n}]},t.prototype.graph=function(t){var e=this;return function(n,i){var a=t.data||{};if(a.kgName=t.kgName,a.id=e.settings.tgc2.startInfo.id,a.isRelationMerge=!0,e.settings.tgc2Filter){var s=e.settings.tgc2Filter.getFilterOptions();$.extend(!0,a,s)}if(e.settings.tgc2Page){var o=e.settings.tgc2Page.page;a.pageNo=o.pageNo,a.pageSize=o.pageSize}hieknjs.kgLoader({url:e.settings.baseUrl+"graph",type:1,params:a,success:function(t){if(t&&t.rsData&&t.rsData.length){var e=t.rsData[0];i(e)}}})}},t.prototype.relation=function(t){var e=this;return function(n,i){var a=_.map(e.settings.tgc2.startInfo.nodes,"id"),s=t.data||{};if(s.ids=a,s.isShortest=!0,s.connectsCompute=!0,s.statsCompute=!0,s.kgName=t.kgName,s.statsConfig=t.statsConfig,e.settings.tgc2Filter){var o=e.settings.tgc2Filter.getFilterOptions();$.extend(!0,s,o)}hieknjs.kgLoader({url:e.settings.baseUrl+"relation",type:1,params:s,success:function(t){if(t&&t.rsData&&t.rsData.length){var e=t.rsData[0];i(e)}},error:function(){toastr.error("网络接口错误！")}})}},t.prototype.path=function(t){var e=this;return function(n,i){var a=t.data||{};if(a.start=e.settings.tgc2.startInfo.start.id,a.end=e.settings.tgc2.startInfo.end.id,a.isShortest=!0,a.connectsCompute=!0,a.statsCompute=!0,a.kgName=t.kgName,a.statsConfig=t.statsConfig,e.settings.tgc2Filter){var s=e.settings.tgc2Filter.getFilterOptions();$.extend(!0,a,s)}hieknjs.kgLoader({url:e.settings.baseUrl+"path",type:1,params:a,success:function(t){if(t&&t.rsData&&t.rsData.length){var e=t.rsData[0];i(e)}},error:function(){toastr.error("网络接口错误！")}})}},t}window.HieknSDKService=t()}();