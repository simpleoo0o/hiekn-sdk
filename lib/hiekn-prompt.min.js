/**
     * @author: 
     *    jiangrun002
     * @version: 
     *    v0.1.6
     * @license:
     *    Copyright 2017, jiangrun. All rights reserved.
     */

!function(t,e){"use strict";function n(){function n(t){var e="Hiekn Prompt Tip: ";console.error(e+t)}function o(t,n,o){if(t.enable){var a=e(t.content);n.append(a),(t.clickEnable||"undefined"==typeof t.clickEnable)&&(a.css("cursor","pointer"),a.on("click",function(e){t.onclick(o,e)}))}}function a(a){if(!a.options.container)return void n("container is required");a.$container=e(a.options.container);var i=a.$container,r=e('<input type="text" autocomplete="off" placeholder="'+a.options.placeholder+'">');o(a.options.icon.search,i,a),i.addClass("has-search"),i.append(r),o(a.options.icon.enter,i,a),i.addClass("has-enter"),o(a.options.icon.close,i,a),i.addClass("has-close");var s=e('<ul class="hiekn-search-prompt hide"></ul>');if(i.addClass("hiekn-search-group"),a.options.promptContainerParent){e(a.options.promptContainerParent).append(s);var l=i.offset().left,p=i.offset().top;if("bottom"!=a.options.position)return void n("promptContainerParent && position = top is not support yet");s.css({left:l,top:p+i.height()+1})}else if(i.append(s),"top"==a.options.position){var c=i.height();s.css({left:l,top:"auto",bottom:c})}a.$itemsContainer=s,s.on("click","li",function(){var t=e(this).data("data");a.options.onSearch(t,i)}),i.on("input focus keyup","input",function(e){var n=r.val();if(s.removeClass("hide"),a.hidePromptTimeout&&clearTimeout(a.hidePromptTimeout),"keyup"==e.type||"focusin"==e.type||"focus"==e.type){r.val();if(n?i.addClass("has-value"):i.removeClass("has-value"),"keyup"==e.type){var o=s.children().length;if(o>0){var l=t.event?e.keyCode:e.which,p=s.find("li.on"),c=p.index(),h=!0,d=null;if(13==l)d=p.data("data"),s.addClass("hide"),a.options.onSearch(d,i);else if(38==l){var u=0==c?o-1:c-1;p=s.children(":eq("+u+")"),p.addClass("on").siblings("li").removeClass("on"),d=p.data("data"),a.options.onSelectItemChange(d,a.$container)}else if(40==l){var m=c==o-1?0:c+1;p=s.children(":eq("+m+")"),p.addClass("on").siblings("li").removeClass("on"),d=p.data("data"),a.options.onSelectItemChange(d,a.$container)}else h=!1;if(h)return}}else"focusin"!=e.type&&"focus"!=e.type||i.addClass("active")}if(a.options.promptEnable)n&&a.onPromptStart(n);else if("keyup"==e.type){var l=t.event?e.keyCode:e.which;13==l&&a.options.onSearch(n,i)}"input"==e.type&&n!=r.data("data")&&(a.options.onSearchTextChange(n,a.$container),r.data("data",n))}).on("blur","input",function(){setTimeout(function(){i.removeClass("active"),s.addClass("hide")},300)})}var i=function(t){var o=this,i={container:null,onSelectItemChange:e.noop,onSearchTextChange:e.noop,cache:{enable:!0,maxNum:50,historyList:[]},position:"bottom",placeholder:"请输入关键词...",icon:{search:{enable:!0,clickEnable:!0,onclick:function(t){var n=t.getSelectedItem();t.options.onSearch(n,e(t.options.container))},content:'<svg fill="#aaa" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'},close:{enable:!0,onclick:function(t){t.clear()},content:'<svg fill="#aaa" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'},enter:{enable:!0,clickEnable:!0,onclick:function(t){var n=t.getSelectedItem();t.options.onSearch(n,e(t.options.container))},content:'<svg fill="#aaa" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 9l1.42 1.42L8.83 14H18V4h2v12H8.83l3.59 3.58L11 21l-6-6 6-6z"/></svg>'}},promptContainerParent:null,promptEnable:!0,onPrompt:function(t,o){var a={};a.prefix=t,e.ajax({url:o.options.promptUrl+"&"+e.param(a),type:"GET",success:function(e){if(o.prompt==a.prefix){var n=e.data.rsData;o.startDrawPromptItems(n,t)}},error:function(){n("Prompt Fail！")}})},nodata:{enable:!0,content:"抱歉,暂无数据"},drawPromptItem:function(t,e){return t.name.replace(new RegExp("("+e+")","gi"),'<span class="highlight">$1</span>')},drawItemTitle:function(t){return t.name},promptUrl:null,onSearch:function(t,e){console.log(t)}};o.$container=null,o.$itemsContainer=null,o.hidePromptTimeout=null,o.options=e.extend(!0,{},i,t),a(o)};return i.prototype.clear=function(){var t=this;t.$itemsContainer.empty(),t.$container.removeClass("has-value"),t.$container.find("input").val(""),t.options.onSelectItemChange(null,t.$container),t.options.onSearchTextChange("",t.$container)},i.prototype.getSelectedItem=function(){var t=this,e=t.$itemsContainer.find("li.on");return e.length?e.data("data"):null},i.prototype.onPromptStart=function(t){var e=this;e.prompt=t,e.hidePromptTimeout&&clearTimeout(e.hidePromptTimeout),e.hidePromptTimeout=setTimeout(function(){var n=e.history(t);n.length?e.startDrawPromptItems(n,t):e.options.onPrompt(t,e,e.startDrawPromptItems)},300)},i.prototype.history=function(t,e){var n=this;if(n.options.cache.enable){var o=n.options.cache.historyList;if(!e){for(var a=0;a<o;a++)o[a].key&&(e=o[a].value);return e||[]}o.length>=n.options.cache.maxNum&&o.shift(),o.push({key:t,value:e})}else if(e)return[]},i.prototype.startDrawPromptItems=function(t,n){var o=this,a=o.$itemsContainer;if(a.empty(),t&&t.length)o.history(n,t),t.forEach(function(t){var i=o.options.drawPromptItem(t,n),r=o.options.drawItemTitle(t),s=e('<li title="'+r+'">'+i+"</li>").data("data",t);a.append(s)}),a.children("li").eq(0).addClass("on"),o.options.onSelectItemChange(t[0],o.$container);else{if(o.options.nodata.enable){var i=o.options.nodata.content,r=e('<li class="no-data">'+i+"</li>");a.append(r)}o.options.onSelectItemChange(null,o.$container)}},i}t.hieknPrompt=n()}(window,jQuery);